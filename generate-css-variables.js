let fs = require('fs');

let variablesLess = fs.readFileSync('./variables.less', 'UTF-8').split("\n");

let cssVariables = `
/* THIS FILE IS AUTOGENERATED - DO NOT MODIFY */

@import (reference) './variables';

:root {
`;

let whitespace = /^\s*$/;
let comment = /^\s*\/[/*]/;
let varRegex = /^(\s*)@([^:]+):/;

variablesLess.forEach(line => {
    let m;
    //for whitespace only lines, insert a newline
    if(whitespace.test(line)) {
        cssVariables += '\n';
    }
    //for comment only lines insert the comment with a tab
    else if(comment.test(line)) {
        cssVariables += `\t${line}\n`;
    }
    //check for variable definitions and add them as new css variable declarations of the form
    //  --foo-bar: @foo-bar;
    else if(m = varRegex.exec(line)) {
        cssVariables += `\t${m[1]}--${m[2]}: @${m[2]};\n`;
    }
});

cssVariables = cssVariables.trim() + '\n}';

fs.writeFileSync('./css-variables.less', cssVariables, 'UTF-8');

